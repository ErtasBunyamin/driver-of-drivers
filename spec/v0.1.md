# Hub Automation Framework - Core Specification v0.1

**Version**: 0.1
**Status**: Draft (MVP)
**Date**: 2026-01-11

## 1. Overview
The Hub Framework is a unified Web UI automation facade that allows running tests on different providers (Selenium, Playwright) using a single, standard API compatible with Selenium WebDriver.

## 2. Facade Goal (WebDriver Compatibility)
The primary goal is to support existing standard PageObject patterns and Selenium `WebDriver` APIs.

### 2.1 HubWebDriver
- Must implement `org.openqa.selenium.WebDriver`.
- Must implement `org.openqa.selenium.JavascriptExecutor`.
- Must implement `org.openqa.selenium.TakesScreenshot`.

### 2.2 HubWebElement
- Must implement `org.openqa.selenium.WebElement`.
- Internal logic handles `StaleElementReferenceException` automatically by re-resolving the locator if possible.

## 3. Provider Contract
All providers must implement the `HubProvider` interface to bridge the specific automation tool with the Hub facade.

```java
public interface HubProvider {
    /**
     * Starts a new session with the given capabilities.
     */
    ProviderSession start(SessionCapabilities caps);

    /**
     * Stops the session.
     */
    void stop(ProviderSession session);

    /**
     * Finds a single element.
     */
    ProviderElement find(ProviderSession session, HubLocator locator);

    /**
     * Finds all matching elements.
     */
    List<ProviderElement> findAll(ProviderSession session, HubLocator locator);

    void click(ProviderSession session, ProviderElement el);
    void type(ProviderSession session, ProviderElement el, String text);
    void navigate(ProviderSession session, String url);
}
```

## 4. Command Pipeline Lifecycle
Every action on the Facade (e.g., `driver.findElement`, `element.click`) is converted into a **Command** object and passed through the pipeline.

**Stages:**
1.  **BeforeCommand**: Logging, context setup.
2.  **Stabilize**: (MVP) Basic `document.readyState` check or small delay.
3.  **Execute**: Provider implementation call.
4.  **AfterCommand**: Telemetry emission, artifact capture.
5.  **OnError**: Exception normalization, retry decision (if policy allows).

## 5. Artifacts and Telemetry

### 5.1 Command Data Model (run.json)
```json
{
  "commandId": "uuid",
  "name": "CLICK",
  "target": "css=.btn-primary",
  "durationMs": 120,
  "result": "SUCCESS",
  "provider": "selenium",
  "artifacts": {
    "screenshot": "artifacts/uuid-screenshot.png",
    "html": "artifacts/uuid-page.html"
  }
}
```

### 5.2 Artifact Policy (MVP)
- **OnFailure**: Capture screenshot + HTML source + console logs.
- **OnSuccess**: No artifact (unless 'Always' mode is active).

## 6. Config Format
Configuration is managed via `hub.yaml` or `application.yml`.

```yaml
hub:
  provider: selenium # or playwright
  browser: chrome
  timeouts:
    implicit: 5000
    pageLoad: 30000
  artifacts:
    mode: ON_FAILURE # ALWAYS, OFF
```
